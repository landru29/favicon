angular.module("favicon",[]),angular.module("favicon").provider("favicon",function(){"use strict";var t={},i=function(t,i){this.options=angular.extend({color:"green",height:32,width:32,autoInject:!0,type:"pie",border:!0,successColor:"#53C516",failureColor:"#F6491F"},i),this.rootScope=t,this.canvas=window.document.createElement("canvas"),this.canvas.height=this.options.height,this.canvas.width=this.options.width,this.context=this.canvas.getContext("2d");for(var e=window.document.head.getElementsByTagName("link"),n=0;n<e.length;n++)/icon/.test(e[n].getAttribute("rel"))&&(this.oldRhef=e[n].getAttribute("href"));if(this.options.autoInject){for(var e=window.document.head.getElementsByTagName("link"),o=!1,n=0;n<e.length;n++)/icon/.test(e[n].getAttribute("rel"))&&(o=!0);if(!o){var s=document.createElement("link");s.setAttribute("rel","icon"),window.document.head.appendChild(s)}}};i.prototype.restore=function(){this.repaint(this.oldHref)},i.prototype.getHref=function(){return this.canvas.toDataURL("image/png")},i.prototype.getSize=function(t){var i={centerX:this.canvas.width/2,centerY:this.canvas.height/2,height:this.canvas.height,width:this.canvas.width};return t&&void 0!==i[t]?i[t]:i},i.prototype.repaint=function(t){if(this.options.autoInject)for(var i=window.document.head.getElementsByTagName("link"),e=0;e<i.length;e++)/icon/.test(i[e].getAttribute("rel"))&&i[e].setAttribute("href",t||this.getHref());this.rootScope.$broadcast("favicon-set-progress")},i.prototype.clearIcon=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},i.prototype.getContext=function(){return this.context},i.prototype.setProgress=function(t){switch(this.options.type){case"donut":this.setDonutProgress(t);break;default:this.setPieProgress(t)}},i.prototype.getColor=function(t){return"rainbow"!==this.options.color?this.options.color:"hsl("+90*t+", 100%, 50%)"},i.prototype.addCircle=function(t,i){if(i){var e=this.canvas.width/2,n=this.canvas.height/2,o=Math.min(this.canvas.width,this.canvas.height)/2;this.context.strokeStyle=this.getColor(t),this.context.lineWidth=1,this.context.beginPath(),this.context.arc(e,n,o-this.context.lineWidth,0,2*Math.PI),this.context.stroke()}},i.prototype.setPieProgress=function(t){var i=this.canvas.width/2,e=this.canvas.height/2,n=Math.min(this.canvas.width,this.canvas.height)/2;this.clearIcon(),this.context.fillStyle=this.getColor(t),this.context.beginPath(),this.context.arc(i,e,n,0,2*Math.PI*t),this.context.lineTo(i,e),this.context.fill(),this.addCircle(t,this.options.border),this.repaint()},i.prototype.setDonutProgress=function(t){var i=this.canvas.width/2,e=this.canvas.height/2,n=Math.min(this.canvas.width,this.canvas.height)/3;this.clearIcon(),this.context.lineWidth=Math.min(this.canvas.width,this.canvas.height)/4,this.context.strokeStyle=this.getColor(t),this.context.beginPath(),this.context.arc(i,e,n,0,2*Math.PI*t,!1),this.context.stroke(),this.addCircle(t,this.options.border),this.repaint()},i.prototype.setSuccess=function(){var t=this.canvas.width/2,i=this.canvas.height/2,e=Math.min(this.canvas.width,this.canvas.height)/2;this.clearIcon(),this.context.beginPath(),this.context.arc(t,i,e,0,2*Math.PI,!1),this.context.fillStyle=this.options.successColor,this.context.fill(),this.context.beginPath(),this.context.lineWidth=e/3,this.context.strokeStyle="#FFFFFF",this.context.moveTo(.5*t,1.1*i),this.context.lineTo(t,1.5*i),this.context.lineTo(1.6*t,.6*i),this.context.stroke(),this.repaint()},i.prototype.setFailure=function(){var t=this.canvas.width/2,i=this.canvas.height/2,e=Math.min(this.canvas.width,this.canvas.height)/2;this.clearIcon(),this.context.beginPath(),this.context.arc(t,i,e,0,2*Math.PI,!1),this.context.fillStyle=this.options.failureColor,this.context.fill(),this.context.beginPath(),this.context.lineWidth=e/3,this.context.strokeStyle="#FFFFFF",this.context.moveTo(.5*t,.5*i),this.context.lineTo(1.5*t,1.5*i),this.context.moveTo(1.5*t,.5*i),this.context.lineTo(.5*t,1.5*i),this.context.stroke(),this.repaint()},i.prototype.setOptions=function(t){angular.extend(this.options,t)},this.setOptions=function(i){t=i||{}},this.$get=["$rootScope",function(e){return new i(e,t)}]}),angular.module("favicon").directive("faviconInjector",["favicon",function(t){return{restrict:"A",link:function(i,e){"use strict";i.$on("favicon-set-progress",function(){e.attr("href",t.getHref())})}}}]);